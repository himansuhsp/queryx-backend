from fastapi import FastAPI, UploadFile, File
from pydantic import BaseModel
from google import genai
import os

# Load API key
client = genai.Client(api_key=os.getenv("GEMINI_API_KEY"))

app = FastAPI()

class Query(BaseModel):
    query: str

# ------------------ TEXT API ------------------
@app.post("/ask")
async def ask_ai(data: Query):
    response = client.models.generate_content(
        model="gemini-2.0-flash",
        contents=data.query
    )
    return {"response": response.text}


# ------------------ IMAGE API ------------------
@app.post("/ask-image")
async def ask_image(file: UploadFile = File(...)):

    img_bytes = await file.read()

    response = client.models.generate_content(
        model="gemini-2.0-flash",
        contents=[
            {"mime_type": file.content_type, "data": img_bytes},
            {"text": "Solve this problem step-by-step like a physics expert teacher."}
        ]
    )

    return {"response": response.text}

